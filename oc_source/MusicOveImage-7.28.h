//
//  MusicOveImage.h
//  ReadStaff
//
//  Created by pixeltek on 12-5-20.
//  Copyright (c) 2012年 __MyCompanyName__. All rights reserved.
//

/*
 icon512: 
 Bach: Lucida Calligraphy 72
 Notebook for Anna:  
 
 icon114: 
 Bach: Lucida Calligraphy 24
 Notebook for Anna:  12
 
 
 icon72:
 Bach: Lucida Calligraphy 18
 
 icon54:
 Bach: Lucida Calligraphy 14
 
 */

/*
 ove reader:
 <string>music score</string>
 <string>com.pixeltek.overeader</string>
 */
//#define OVE_READER 0

/*
 Bach Free:
 <string>Bach Free</string>
 <string>com.pixeltek.BachFree</string>
 */
//#define BACH_FREE 1

/*
 http://www.sheetmusicplus.com/title/J-S-Bach-Notebook-For-Anna-Magdalena-Bach/19120576#
 Bach BWV Anh:
 
 J.S. Bach: Notebook For Anna Magdalena Bach
 
 Composer: Johann Sebastian Bach (1685-1750)
 Instrument:	Piano Solo 
 Genre:	Baroque Period 
 Level:	Level 4-6 (Late Intermediate)
 Diffculty:  4-note chords in both hands with large stretches and leaps. Irregular and complicated rhythms.
 
 <string>Bach BWV Anh</string>
 <string>com.pixeltek.BachAnh</string>
 
 Description in App Store
 
 The great musics of J.S.Bach from his "Notebook for Anna Magdalena Bach".
 The dificulty level is 4-6 (Late Intermediate), which means you can play 4-note chords in both hands with large stretches and leaps. Irregular and complicated rhythms.
 
 1. Listen the music following the score with the high light cursor.
 2. You can place your iPad on your Piano and play following the score.
 3. Print the score.
 
 巴赫初级钢琴曲集里面的乐曲只要来之巴赫的安娜日记。
 难度等级是4－6级，学完本教程后你可以弹奏4音和弦，和一些不规则的复杂的旋律。
 主要特点：
 1. 每首曲子都可以跟随光标自动演奏
 2. 你可以把iPad放到你的钢琴上当作琴谱使用
 3. 你也可以把乐谱打印下来
 
 */
//#define BACH_FULL 2

/*
 http://www.sheetmusicplus.com/title/Elementary-Instruction-for-the-Pianoforte/3162853#
 Elementary Instruction Book for the Pianoforte
 
 Composer:   Ferdinand Beyer (1803-1863)
 Instrument: Piano Solo, Piano Method 
 Genre:      Classical Period 
 Level:	     Level 1-3 (Early Intermediate)
 Diffculty:  Independent movement of the left hand. Multiple chords in a measure, and the introduction of triplets.
 
 <string>Beyer Piano Basic Course</string>
 <string>com.pixeltek.BeyerBasic</string>
 
 Description on App store:
 
 Follow the "Elementary Instruction Book for the Pianoforte" to learn piano step by step. 
 The dificulty level is 1-3 (Early Intermediate), which means you can play independent movement of the left hand. Multiple chords in a measure, and the introduction of triplets.
 1. There 106 basic piano music from Beyer.
 2. Listen the music following the highlight cursor. 
 3. You can place your iPad on your Piano and play following the score. 
 4. Print the score.
 
 拜厄基础钢琴教程。
 难度等级是1-3级，学完本教程后你可以左手独立移动，并且可以在一个小节里弹奏多个和弦。
 主要特点：
 1. 包含全部拜厄基础教程的106首钢琴曲
 2. 每首曲子都可以跟随光标自动演奏
 3. 你可以把iPad放到你的钢琴上当作琴谱使用
 4. 你也可以把乐谱打印下来
 
 
 */
//#define BEYER_FULL 3

/*
 http://www.sheetmusicplus.com/title/Practical-Method-For-Beginners-Op-599/3142279
 Practical Method For Beginners, Op. 599
 
 Instrument: Piano Solo, Piano Method 
 Genre:      Classical Period 
 Level:	     Level 3-7 (Late Intermediate)
 Composer:   Carl Czerny  (1791-1857)
 4 to 5-note chords in both hands and scales in octaves in both hands.
 
 <string>Czerny OP.599</string>
 <string>com.pixeltek.CzernyBasic</string>
 
 Description on App store:
 
 Follow the "Czerny Practical Method for Beginners on the Piano, Op. 599" to learn piano step by step. 
 The dificulty level is 3-7 (Late Intermediate), which means you can play 4 to 5-note chords in both hands and scales in octaves in both hands after learnling these musices.
 
 The main feature is:
 1. There 100 basic piano music from Czerny Op.599. 
 2. Listen the music following the high light cursor. 
 3. You can place your iPad on your Piano and play following the score. 
 4. Print the score.
 
 车尔尼《钢琴初步教程》 作品599。
 难度等级是3-7级,学完本教程后你可以双手弹奏4-5个音的和弦。
 主要特点:
 1. 包含全部车尔尼599里的100首钢琴曲
 2. 每首曲子都可以跟随光标自动演奏
 3. 你可以把iPad放到你的钢琴上当作琴谱使用
 4. 你也可以把乐谱打印下来
 */


/*
 车尔尼
 初学者先弹《钢琴初步教程》(作品599号)、Czerny -- Practical Method For Beginners, Op. 599 
 再来是《钢琴流畅练习曲》(作品849号)、Czerny -- 30 New Studies in Technique, Op. 849   Level 8 (Early Advanced)
 然后弹《钢琴快速练习曲》(作品299号)，Czerny: School of Velocity, Op. 299
 最后是〈手指灵巧的技术练习〉(作品740号，也称699号)， Art De Delier Les Doigts Op.699
 最后的最后是很少有人弹到的〈高级技术练习曲〉(作品365号) School of the Virtuoso, Op. 365
 */

/*
 难度等级：
 1. 拜厄钢琴基础教程 (1-3级)
 2. 巴赫 (1-3级)
 3. 车尔尼599 (1-3级)
 
 (1) 等级1(起步)
 基本不移动的五指弹奏，简单的双手同时弹奏，有一些3音和弦，每一小节最多一个和弦。
 主要接触四分音符，二分音符，全音符，偶尔八分音符。
 (2) 等级2(初级)
 有限移动的五指弹奏，有一些3音和弦，每一小节多于一个和弦。
 主要接触四分音符，附点, 二分音符，八分音符。
 (3) 等级3(初中级)
 独立移动左手，左右手相反方向移动。多音和弦，每一小节可能多个和弦。
 主要接触八分音符，三连音,附点节奏。
 (4) 等级4(中级)
 可以在按键上下快速的移动，2个八度的琶音，更多的和弦。
 更复杂的节奏，十六分音符
 (5) 等级5(中级)
 段落会跨越几个小节，主旋律可能需要双手表达，多种和弦包括七音和弦
 更复杂的节奏，包括十六分音符
 注意读谱更加困难，有更多超出五线谱上或下的音符
 
 (6)等级6 (中后级)
 更大跨度的段落，超过八度，需要双手表达优美的主旋律，双手弹奏全部四个音符的和弦，需要大手舒展，大跨越。
 双手弹奏不规则的节奏，更复杂的模式
 更高的读谱难度，更完整的和弦，有时要跨越两端的键盘
 
 (7)等级 7 (中后级)
 双手都会跨越八度，在同一只手上弹奏主旋律和伴奏，可以双手弹奏所有的四音和五音和弦
 更大的超过八度的跨度，
 
 (8)等级 8 (初高级)
 学习全部音程，错综复杂的旋律线，跨越八度的四音和五音符和弦，
 错综复杂的节奏
 同一只手弹奏非常复杂的旋律和伴奏，你会感觉手太小了。
 
 (9)等级9 (高级)
 有不同的伴奏模式组合成的更大的段落， 跨越一个八度的所有类型的大调，小调，渐强，渐弱和弦。
 需要更大的速度和完整的技巧来弹奏更加困难的音乐
 
 
 (10)等级10 (高级)
 复杂的，往往需要极其快速的节奏，复杂的碎和弦模式，充分和弦，大手扩展的旋律线
 更多的复杂polyrhythms，复杂的米
 复杂的旋律数字
 非常先进的水平，很难注意阅读，频繁的时间签名变化，名家水平的技术设施需要
 
 Intricate melodic lines often requiring extremely fast tempos, Complex broken-chord patterns, full chords, and large hand extensions
 More complicated polyrhythms, Complex meter
 Complicated melodic figures
 Very advanced level, very difficult note reading, frequent time signatures changes, virtuosic level technical facility needed 
 
 
 The Sheet Music difficulty level guideline:
 1. Beyer: Elementary Instruction Book for the Pianoforte (level 1-3)
 2. J.S. Bach: Notebook For Anna Magdalena Bach (level 4-6)
 3. Czerny: Practical Method For Beginners, Op. 599 (level 3-7)
 
 (1). Level 1 (Elementary)
 Five-finger patterns with a little hand movement, Simple hands-together playing, Some 3-note chords, 1 chord per measure.
 Quarter, half, dotted half, and whole notes, some eighth notes
 Easy note reading.
 
 (2). Level 2 (Late Elementary)
 Limited hand movement, Some hand position changes and finger extensions, 3-note chords, More than 1 chord per measure.
 Quarter, half, dotted half, and whole notes, and eighth notes
 May be labeled as "Big Note"
 
 (3). Level 3 (Early Intermediate)
 Independent movement of the left hand, Hands in parallel and contrary motion, Multiple chords in a measure, More variety of chords
 Eighth to whole notes, triplets, dotted rhythms
 Reading notes in most major and minor keys
 
 (4) Level 4 (Intermediate)
 Scales moving up and down the keyboard at a faster tempo, Arpeggios covering 2 octaves, Many chords, some 4-note
 More complex rhythms, Sixteenth notes
 May be labeled "Easy Piano"
 
 (5) Level 5 (Intermediate)
 Scale passages over several measures, Melodies may be in both hands, More variety of chords including seventh chords
 More complex rhythms, including sixteenth notes and dotted rhythms
 More difficult note reading, with ledger lines above and below the staff
 
 (6)Level 6 (Late Intermediate)
 Longer scale passages, some in octaves, Melodic lines in both hands, Full four note chords in both hands, requiring large hand stretches, large leaps.
 Irregular rhythmic groups between the hands, More complicated patterns
 More difficult note reading, with full chords sometimes on opposite ends of the keyboard
 
 (7) Level 7 (Late Intermediate)
 Scales in octaves in both hands, Melody and accompaniment in same hand, Full four- to five-note chords in both hands
 Large leaps and broken octaves, Polyrhythms and complex rhythmic patterns
 Moving melodic lines in both hands requiring greater technical facility
 
 (8) Level 8 (Early Advanced)
 Scales in 3rds, 10ths and octaves, whole tone scales and modes, Intricate melodic lines, Four- and five-note chords spanning more than an octave, rolled chords in 10ths
 Intricate rhythms
 Difficult music for smaller hands with more melody and accompaniment lines in same hand
 
 (9) Level 9 (Advanced)
 Extensive scale passages incorporated into pieces with active accompaniment patterns, All types of major, minor, diminished and augmented chords spanning more than an octave
 Intricate rhythms, Complex meter
 Difficult music requiring greater velocity and overall technical facility
 
 (10) Level 10 (Advanced)
 Intricate melodic lines often requiring extremely fast tempos, Complex broken-chord patterns, full chords, and large hand extensions
 More complicated polyrhythms, Complex meter
 Complicated melodic figures
 Very advanced level, very difficult note reading, frequent time signatures changes, virtuosic level technical facility needed 
 
 */

#import <UIKit/UIKit.h>
#import <Foundation/Foundation.h>
#import "MusicOve.h"
//#import "MusicImage.h"
#import <CoreFoundation/CoreFoundation.h>
#import <CoreAudio/CoreAudioTypes.h>
#import <CoreMIDI/CoreMIDI.h>
#import <AudioUnit/AudioUnit.h>

//#define MY_VERSION BEYER_FULL//BACH_FULL//BEYER_FULL//CZERNY_FULL//OVE_READER

#define MAX_POS_NUM 30
@interface NotePos : NSObject {
    int start_y[MAX_POS_NUM];
}
@property (nonatomic, assign) unsigned char page,staff;
@property (nonatomic, assign) unsigned short width,height;
@property (nonatomic, assign) int start_x;
@property (nonatomic, assign) int part_index;//for MusicXML multi part, for OVE: always =0
- (int) start_y:(int)index;
- (void)start_y:(int)y forIndex:(int)index;
- (void)copyFrom:(NotePos*)pos;
//for midi play
@property (nonatomic, assign) Float64 timeStamp;
@end

@interface MeasurePos : NSObject {
}
@property (nonatomic, assign) unsigned char page;
@property (nonatomic, assign) unsigned short width,height;
@property (nonatomic, assign) int start_x, start_y;
@property (nonatomic, retain) NSMutableArray *note_pos; //NotePos
@end

//@protocol MusicOvePlayDelegate;
@interface MusicOveImage : UIResponder
{
    //NSMutableArray *measure_pos; //MeasurePos
    //BOOL isIpad;
    CGSize screen_size;
    
    BOOL isLandscape;
    
    //int GROUP_LINES; //多少行
    //int MEASURES_EACH_LINE;   //每行多少小节
    //int DIAOHAO_WIDTH; //调号占得宽度
    
    int STAFF_OFFSET[20];
    
    float OFFSET_X_UNIT,OFFSET_Y_UNIT;
    float ending_x1,ending_y1;
    CGContextRef thisctx;
}
@property (nonatomic,strong) NSMutableArray *staff_images; //array of SVG string
@property (nonatomic,readonly) NSMutableArray *measure_pos; //array of MeasurePos
@property (nonatomic,readonly) NSUInteger STAFF_COUNT;
@property (nonatomic,readonly) int start_tempo_num; //每分钟多少个拍
@property (nonatomic,readonly) float start_tempo_type; //每拍是什么类型:几个全音符：1,全，1/2:二分音符，1/4:4分音符, 3/8:4分半音符，1/8:8分音符
@property (nonatomic,readonly) int start_numerator, start_denominator; //分子，分母
@property (nonatomic, assign) BOOL showJianpu, pageMode;
@property (nonatomic, assign) int minNoteValue, maxNoteValue;

- (void)loadMusic:(id)music musicSize:(CGSize)musicSize screenSize:(CGSize)screenSize;
- (void)LoadMusicKnowledgeWithSize:(CGSize)screen;
- (CGPoint)pointForNote:(int)note
                measure:(int)measure_index
                   note:(int)note_index
                  staff:(int)staff;

@property (nonatomic, strong) OveMusic *music;
- (int)getStaffOffset:(int)track;
@end


